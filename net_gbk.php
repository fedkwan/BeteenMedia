<?php
include 'conn.php';
include 'c_ps_select.php';
include 'hack/Snoopy.class.php';

mysql_query("SET NAMES 'gbk'");

$k = 3; $content_array = array(); $content_array_num = array(); $line = array();

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//去掉script，css，特殊字符，待添加。*************************************************************
function delScript($bturl){//*********************************************************************
			$snoopy = new Snoopy;//***************************************************************
			$snoopy->fetchtext($bturl);//*********************************************************
			$string = $snoopy->results;//*********************************************************
			return $string; }//*******************************************************************
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//计算PWS**********************************************************************************************
function pend($ari=array(),$left,$sp)//****************************************************************
	{$mp=1; $mp2=1; $ni=count($ari);//*****************************************************************
	//for ($e=0; $e<$ni; $e++) {echo $ari[$e].'==='; echo (100-$ari[$e]).'///';}//*********************
	for ($e=0; $e<$ni; $e++) {$mp *= $ari[$e]; $mp2 *= 100-$ari[$e];}//********************************
	$factor = 5;//*************************************************************************************
	$mp = $mp*pow($factor,$left)*$sp; $mp2 = $mp2*pow((100-$factor),$left)*(1-$sp);//******************
	$fk = $mp/($mp+$mp2); return ($fk*pow(10,20));}//**************************************************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

$after_preg_content = delScript($_GET['jk']);
$temp = str_replace(chr(13),'|beteen|',$after_preg_content);
$content_array = explode('|beteen|',$temp);

foreach ($content_array as $x=>$y)
{/*echo $y."<br>";*/ $content_array_num[$x]=strlen($y);}

foreach ($content_array_num as $x=>$y)
{for ($i=$x;$i<=$x+$k;$i++) {$yall+=$y;} $content_array_num[$x]=$yall; $yall=0;}

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//获取title******************************************************************************************************************
foreach ($content_array as $x=>$y){if (strlen($y)>15){$title=$y; break;}}//**************************************************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//正文块截取***********************************************************************************
$content_array_num_max = (max($content_array_num)/3);//****************************************
foreach ($content_array_num as $x=>$y)//*******************************************************
{if ($content_array_num[$x]>$content_array_num_max)//******************************************
{for ($j=$x;;$j--)//***************************************************************************
{if ($content_array_num[$j]<=$content_array_num_max/2) {break;} $line[] = $j;}}//**************
{for ($l=$x;;$l++)//***************************************************************************
{if ($content_array_num[$l]<=$content_array_num_max/2) {break;} $line[] = $l;}}}//*************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

$line = array_flip(array_flip($line)); sort($line); $line_num = count($line);
//line 就是正文里面满足的行的行数

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//正文块截取*********************************************************************************************************************
for ($i=0; $i<$line_num; $i++){$yes .= $content_array[$line[$i]]."<br>";}//******************************************************
$z = $title[0]."<br>".$yes; $yes='';//*******************************************************************************************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//echo $z."<br>";

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//SCWS中文切词*********************************************************************************
$so[$u] = scws_open();//***********************************************************************
scws_set_charset($so[$u],'gbk');//*************************************************************
scws_send_text($so[$u],$z);//******************************************************************
$cut_word_top = scws_get_tops($so[$u],30);//***************************************************
$count_top = count($cut_word_top);//***********************************************************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//print_r($cut_word_top);

//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
//提取PSW**************************************************************************************************************************
for ($i=0;$i<$count_top;$i++)//****************************************************************************************************
	{//****************************************************************************************************************************
	if($word=='br')//**************************************************************************************************************
		{continue;}//**************************************************************************************************************
	if($o==15)//喵的为什么是两个等于号//*******************************************************************************************
		{break;}//*****************************************************************************************************************
	else{//************************************************************************************************************************
		$word = $cut_word_top[$i][word];//*****************************************************************************************
		$p = @mysql_fetch_array(mysql_query("select * from `c_psw` where word = '$word'"));//**************************************
		if(!empty($p))//***********************************************************************************************************
			{//********************************************************************************************************************
			$no = substr($p[text],0,-1);//*****************************************************************************************
			$no = preg_replace('/[{}]/','',$no);//*********************************************************************************
			$noa = explode('+',$no);//*********************************************************************************************
			foreach ($noa as $vv)//************************************************************************************************
				{//****************************************************************************************************************
				$noaa = explode('::',$vv);//***************************************************************************************
				$lus[$noaa[0]][] = $noaa[1];//*************************************************************************************
				//$plus[] = $noaa;//***********************************************************************************************
				}//****************************************************************************************************************
			$cend[] =$word;//******************************************************************************************************
			$o=$o+1;//*************************************************************************************************************
			}//********************************************************************************************************************
		}//************************************************************************************************************************
	}//****************************************************************************************************************************
	$count_plus = count($cend);//**************************************************************************************************
	//echo $count_plus;//**********************************************************************************************************
	if ($count_plus < 2)//*********************************************************************************************************
		{//************************************************************************************************************************
		exit;//********************************************************************************************************************
		}//************************************************************************************************************************
	//echo $cendstr;//*************************************************************************************************************
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

foreach ($lus as $k => $v)
	{
	$else = 15 - count($v);
	$spo = $spe[$k];
	$ppo = pend($v,$else,$spo);
	$range[$k] = $ppo;
	}
arsort($range);
//print_r($range);
//echo '<br>可能属于：';
foreach ($range as $k => $v)
	{
	if ($uu == 1) {break;} 
	echo $k;/*
	$ku = 'b_'.$k;
	$q = @mysql_fetch_array(mysql_query("select * from `a_b` where pinyin = '$ku'"));
	echo $q[name];//.':'.$v.'<br>';*/
	$uu = $uu + 1;
	}
?>